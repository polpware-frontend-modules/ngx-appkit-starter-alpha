// =============================
// Email: info@ebenmonney.com
// www.ebenmonney.com/templates
// =============================
import { Injectable } from '@angular/core';
import { catchError } from 'rxjs/operators';
import { EndpointBase } from '@polpware/ngx-oauth2';
import * as i0 from "@angular/core";
import * as i1 from "@polpware/ngx-appkit-services-alpha";
import * as i2 from "@angular/common/http";
import * as i3 from "@polpware/ngx-oauth2";
export class AccountEndpoint extends EndpointBase {
    constructor(configurations, http, authService) {
        super(http, authService);
        this.configurations = configurations;
        this._usersUrl = '/api/account/users';
        this._userByUserNameUrl = '/api/account/users/username';
        this._currentUserUrl = '/api/account/users/me';
        this._currentUserPreferencesUrl = '/api/account/users/me/preferences';
        this._unblockUserUrl = '/api/account/users/unblock';
        this._rolesUrl = '/api/account/roles';
        this._roleByRoleNameUrl = '/api/account/roles/name';
        this._permissionsUrl = '/api/account/permissions';
    }
    get usersUrl() { return this.configurations.baseUrl + this._usersUrl; }
    get userByUserNameUrl() { return this.configurations.baseUrl + this._userByUserNameUrl; }
    get currentUserUrl() { return this.configurations.baseUrl + this._currentUserUrl; }
    get currentUserPreferencesUrl() { return this.configurations.baseUrl + this._currentUserPreferencesUrl; }
    get unblockUserUrl() { return this.configurations.baseUrl + this._unblockUserUrl; }
    get rolesUrl() { return this.configurations.baseUrl + this._rolesUrl; }
    get roleByRoleNameUrl() { return this.configurations.baseUrl + this._roleByRoleNameUrl; }
    get permissionsUrl() { return this.configurations.baseUrl + this._permissionsUrl; }
    getUserEndpoint(userId) {
        const endpointUrl = userId ? `${this.usersUrl}/${userId}` : this.currentUserUrl;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUserEndpoint(userId));
        }));
    }
    getUserByUserNameEndpoint(userName) {
        const endpointUrl = `${this.userByUserNameUrl}/${userName}`;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUserByUserNameEndpoint(userName));
        }));
    }
    getUsersEndpoint(page, pageSize) {
        const endpointUrl = page && pageSize ? `${this.usersUrl}/${page}/${pageSize}` : this.usersUrl;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUsersEndpoint(page, pageSize));
        }));
    }
    getNewUserEndpoint(userObject) {
        return this.http.post(this.usersUrl, JSON.stringify(userObject), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getNewUserEndpoint(userObject));
        }));
    }
    getUpdateUserEndpoint(userObject, userId) {
        const endpointUrl = userId ? `${this.usersUrl}/${userId}` : this.currentUserUrl;
        return this.http.put(endpointUrl, JSON.stringify(userObject), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUpdateUserEndpoint(userObject, userId));
        }));
    }
    getPatchUpdateUserEndpoint(valueOrPatch, opOrUserId, path, from, userId) {
        let endpointUrl;
        let patchDocument;
        if (path) {
            endpointUrl = userId ? `${this.usersUrl}/${userId}` : this.currentUserUrl;
            patchDocument = from ?
                [{ value: valueOrPatch, path, op: opOrUserId, from }] :
                [{ value: valueOrPatch, path, op: opOrUserId }];
        }
        else {
            endpointUrl = opOrUserId ? `${this.usersUrl}/${opOrUserId}` : this.currentUserUrl;
            patchDocument = valueOrPatch;
        }
        return this.http.patch(endpointUrl, JSON.stringify(patchDocument), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getPatchUpdateUserEndpoint(valueOrPatch, opOrUserId, path, from, userId));
        }));
    }
    getUserPreferencesEndpoint() {
        return this.http.get(this.currentUserPreferencesUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUserPreferencesEndpoint());
        }));
    }
    getUpdateUserPreferencesEndpoint(configuration) {
        return this.http.put(this.currentUserPreferencesUrl, JSON.stringify(configuration), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUpdateUserPreferencesEndpoint(configuration));
        }));
    }
    getUnblockUserEndpoint(userId) {
        const endpointUrl = `${this.unblockUserUrl}/${userId}`;
        return this.http.put(endpointUrl, null, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUnblockUserEndpoint(userId));
        }));
    }
    getDeleteUserEndpoint(userId) {
        const endpointUrl = `${this.usersUrl}/${userId}`;
        return this.http.delete(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getDeleteUserEndpoint(userId));
        }));
    }
    getRoleEndpoint(roleId) {
        const endpointUrl = `${this.rolesUrl}/${roleId}`;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getRoleEndpoint(roleId));
        }));
    }
    getRoleByRoleNameEndpoint(roleName) {
        const endpointUrl = `${this.roleByRoleNameUrl}/${roleName}`;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getRoleByRoleNameEndpoint(roleName));
        }));
    }
    getRolesEndpoint(page, pageSize) {
        const endpointUrl = page && pageSize ? `${this.rolesUrl}/${page}/${pageSize}` : this.rolesUrl;
        return this.http.get(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getRolesEndpoint(page, pageSize));
        }));
    }
    getNewRoleEndpoint(roleObject) {
        return this.http.post(this.rolesUrl, JSON.stringify(roleObject), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getNewRoleEndpoint(roleObject));
        }));
    }
    getUpdateRoleEndpoint(roleObject, roleId) {
        const endpointUrl = `${this.rolesUrl}/${roleId}`;
        return this.http.put(endpointUrl, JSON.stringify(roleObject), this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getUpdateRoleEndpoint(roleObject, roleId));
        }));
    }
    getDeleteRoleEndpoint(roleId) {
        const endpointUrl = `${this.rolesUrl}/${roleId}`;
        return this.http.delete(endpointUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getDeleteRoleEndpoint(roleId));
        }));
    }
    getPermissionsEndpoint() {
        return this.http.get(this.permissionsUrl, this.requestHeaders).pipe(catchError(error => {
            return this.handleError(error, () => this.getPermissionsEndpoint());
        }));
    }
}
/** @nocollapse */ AccountEndpoint.ɵfac = function AccountEndpoint_Factory(t) { return new (t || AccountEndpoint)(i0.ɵɵinject(i1.ConfigurationService), i0.ɵɵinject(i2.HttpClient), i0.ɵɵinject(i3.AuthService)); };
/** @nocollapse */ AccountEndpoint.ɵprov = i0.ɵɵdefineInjectable({ token: AccountEndpoint, factory: AccountEndpoint.ɵfac });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AccountEndpoint, [{
        type: Injectable
    }], function () { return [{ type: i1.ConfigurationService }, { type: i2.HttpClient }, { type: i3.AuthService }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjb3VudC1lbmRwb2ludC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvbHB3YXJlL25neC1hcHBraXQtc3RhcnRlci1hbHBoYS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9hY2NvdW50LWVuZHBvaW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0NBQWdDO0FBQ2hDLDZCQUE2QjtBQUM3QiwrQkFBK0I7QUFDL0IsZ0NBQWdDO0FBRWhDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHM0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTVDLE9BQU8sRUFFSCxZQUFZLEVBQ2YsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7QUFLOUIsTUFBTSxPQUFPLGVBQWdCLFNBQVEsWUFBWTtJQXFCN0MsWUFBb0IsY0FBb0MsRUFBRSxJQUFnQixFQUFFLFdBQXdCO1FBQ2hHLEtBQUssQ0FBQyxJQUFJLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFEVCxtQkFBYyxHQUFkLGNBQWMsQ0FBc0I7UUFuQnZDLGNBQVMsR0FBVyxvQkFBb0IsQ0FBQztRQUN6Qyx1QkFBa0IsR0FBVyw2QkFBNkIsQ0FBQztRQUMzRCxvQkFBZSxHQUFXLHVCQUF1QixDQUFDO1FBQ2xELCtCQUEwQixHQUFXLG1DQUFtQyxDQUFDO1FBQ3pFLG9CQUFlLEdBQVcsNEJBQTRCLENBQUM7UUFDdkQsY0FBUyxHQUFXLG9CQUFvQixDQUFDO1FBQ3pDLHVCQUFrQixHQUFXLHlCQUF5QixDQUFDO1FBQ3ZELG9CQUFlLEdBQVcsMEJBQTBCLENBQUM7SUFjdEUsQ0FBQztJQVpELElBQUksUUFBUSxLQUFLLE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDdkUsSUFBSSxpQkFBaUIsS0FBSyxPQUFPLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxHQUFHLElBQUks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LENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDWixDQUFDO0lBRUQscUJBQXFCLENBQUksTUFBYztRQUNuQyxNQUFNLFdBQVcsR0FBRyxHQUFHLElBQUksQ0FBQyxRQUFRLElBQUksTUFBTSxFQUFFLENBQUM7UUFFakQsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBSSxXQUFXLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FDN0QsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2YsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUM3RSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ1osQ0FBQztJQUdELHNCQUFzQjtRQUVsQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFJLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLElBQUksQ0FDbEUsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ2YsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDO1FBQ3hFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDWixDQUFDOztpR0FwTVEsZUFBZTswRUFBZixlQUFlLFdBQWYsZUFBZTtrREFBZixlQUFlO2NBRDNCLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRW1haWw6IGluZm9AZWJlbm1vbm5leS5jb21cbi8vIHd3dy5lYmVubW9ubmV5LmNvbS90ZW1wbGF0ZXNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5pbXBvcnQge1xuICAgIEF1dGhTZXJ2aWNlLFxuICAgIEVuZHBvaW50QmFzZVxufSBmcm9tICdAcG9scHdhcmUvbmd4LW9hdXRoMic7XG5pbXBvcnQgeyBDb25maWd1cmF0aW9uU2VydmljZSB9IGZyb20gJ0Bwb2xwd2FyZS9uZ3gtYXBwa2l0LXNlcnZpY2VzLWFscGhhJztcblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgQWNjb3VudEVuZHBvaW50IGV4dGVuZHMgRW5kcG9pbnRCYXNlIHtcblxuICAgIHByaXZhdGUgcmVhZG9ubHkgX3VzZXJzVXJsOiBzdHJpbmcgPSAnL2FwaS9hY2NvdW50L3VzZXJzJztcbiAgICBwcml2YXRlIHJlYWRvbmx5IF91c2VyQnlVc2VyTmFtZVVybDogc3RyaW5nID0gJy9hcGkvYWNjb3VudC91c2Vycy91c2VybmFtZSc7XG4gICAgcHJpdmF0ZSByZWFkb25seSBfY3VycmVudFVzZXJVcmw6IHN0cmluZyA9ICcvYXBpL2FjY291bnQvdXNlcnMvbWUnO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2N1cnJlbnRVc2VyUHJlZmVyZW5jZXNVcmw6IHN0cmluZyA9ICcvYXBpL2FjY291bnQvdXNlcnMvbWUvcHJlZmVyZW5jZXMnO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3VuYmxvY2tVc2VyVXJsOiBzdHJpbmcgPSAnL2FwaS9hY2NvdW50L3VzZXJzL3VuYmxvY2snO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX3JvbGVzVXJsOiBzdHJpbmcgPSAnL2FwaS9hY2NvdW50L3JvbGVzJztcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9yb2xlQnlSb2xlTmFtZVVybDogc3RyaW5nID0gJy9hcGkvYWNjb3VudC9yb2xlcy9uYW1lJztcbiAgICBwcml2YXRlIHJlYWRvbmx5IF9wZXJtaXNzaW9uc1VybDogc3RyaW5nID0gJy9hcGkvYWNjb3VudC9wZXJtaXNzaW9ucyc7XG5cbiAgICBnZXQgdXNlcnNVcmwoKSB7IHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb25zLmJhc2VVcmwgKyB0aGlzLl91c2Vyc1VybDsgfVxuICAgIGdldCB1c2VyQnlVc2VyTmFtZVVybCgpIHsgcmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbnMuYmFzZVVybCArIHRoaXMuX3VzZXJCeVVzZXJOYW1lVXJsOyB9XG4gICAgZ2V0IGN1cnJlbnRVc2VyVXJsKCkgeyByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9ucy5iYXNlVXJsICsgdGhpcy5fY3VycmVudFVzZXJVcmw7IH1cbiAgICBnZXQgY3VycmVudFVzZXJQcmVmZXJlbmNlc1VybCgpIHsgcmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbnMuYmFzZVVybCArIHRoaXMuX2N1cnJlbnRVc2VyUHJlZmVyZW5jZXNVcmw7IH1cbiAgICBnZXQgdW5ibG9ja1VzZXJVcmwoKSB7IHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb25zLmJhc2VVcmwgKyB0aGlzLl91bmJsb2NrVXNlclVybDsgfVxuICAgIGdldCByb2xlc1VybCgpIHsgcmV0dXJuIHRoaXMuY29uZmlndXJhdGlvbnMuYmFzZVVybCArIHRoaXMuX3JvbGVzVXJsOyB9XG4gICAgZ2V0IHJvbGVCeVJvbGVOYW1lVXJsKCkgeyByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9ucy5iYXNlVXJsICsgdGhpcy5fcm9sZUJ5Um9sZU5hbWVVcmw7IH1cbiAgICBnZXQgcGVybWlzc2lvbnNVcmwoKSB7IHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb25zLmJhc2VVcmwgKyB0aGlzLl9wZXJtaXNzaW9uc1VybDsgfVxuXG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGNvbmZpZ3VyYXRpb25zOiBDb25maWd1cmF0aW9uU2VydmljZSwgaHR0cDogSHR0cENsaWVudCwgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKGh0dHAsIGF1dGhTZXJ2aWNlKTtcbiAgICB9XG5cblxuICAgIGdldFVzZXJFbmRwb2ludDxUPih1c2VySWQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICAgICAgY29uc3QgZW5kcG9pbnRVcmwgPSB1c2VySWQgPyBgJHt0aGlzLnVzZXJzVXJsfS8ke3VzZXJJZH1gIDogdGhpcy5jdXJyZW50VXNlclVybDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxUPihlbmRwb2ludFVybCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFVzZXJFbmRwb2ludCh1c2VySWQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cblxuICAgIGdldFVzZXJCeVVzZXJOYW1lRW5kcG9pbnQ8VD4odXNlck5hbWU6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xuICAgICAgICBjb25zdCBlbmRwb2ludFVybCA9IGAke3RoaXMudXNlckJ5VXNlck5hbWVVcmx9LyR7dXNlck5hbWV9YDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxUPihlbmRwb2ludFVybCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFVzZXJCeVVzZXJOYW1lRW5kcG9pbnQodXNlck5hbWUpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cblxuICAgIGdldFVzZXJzRW5kcG9pbnQ8VD4ocGFnZT86IG51bWJlciwgcGFnZVNpemU/OiBudW1iZXIpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICAgICAgY29uc3QgZW5kcG9pbnRVcmwgPSBwYWdlICYmIHBhZ2VTaXplID8gYCR7dGhpcy51c2Vyc1VybH0vJHtwYWdlfS8ke3BhZ2VTaXplfWAgOiB0aGlzLnVzZXJzVXJsO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFQ+KGVuZHBvaW50VXJsLCB0aGlzLnJlcXVlc3RIZWFkZXJzKS5waXBlPFQ+KFxuICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IsICgpID0+IHRoaXMuZ2V0VXNlcnNFbmRwb2ludChwYWdlLCBwYWdlU2l6ZSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuXG4gICAgZ2V0TmV3VXNlckVuZHBvaW50PFQ+KHVzZXJPYmplY3Q6IGFueSk6IE9ic2VydmFibGU8VD4ge1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxUPih0aGlzLnVzZXJzVXJsLCBKU09OLnN0cmluZ2lmeSh1c2VyT2JqZWN0KSwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldE5ld1VzZXJFbmRwb2ludCh1c2VyT2JqZWN0KSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgZ2V0VXBkYXRlVXNlckVuZHBvaW50PFQ+KHVzZXJPYmplY3Q6IGFueSwgdXNlcklkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50VXJsID0gdXNlcklkID8gYCR7dGhpcy51c2Vyc1VybH0vJHt1c2VySWR9YCA6IHRoaXMuY3VycmVudFVzZXJVcmw7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQ8VD4oZW5kcG9pbnRVcmwsIEpTT04uc3RyaW5naWZ5KHVzZXJPYmplY3QpLCB0aGlzLnJlcXVlc3RIZWFkZXJzKS5waXBlPFQ+KFxuICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IsICgpID0+IHRoaXMuZ2V0VXBkYXRlVXNlckVuZHBvaW50KHVzZXJPYmplY3QsIHVzZXJJZCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGdldFBhdGNoVXBkYXRlVXNlckVuZHBvaW50PFQ+KHBhdGNoOiB7fSwgdXNlcklkPzogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPjtcbiAgICBnZXRQYXRjaFVwZGF0ZVVzZXJFbmRwb2ludDxUPih2YWx1ZTogYW55LCBvcDogc3RyaW5nLCBwYXRoOiBzdHJpbmcsIGZyb20/OiBhbnksIHVzZXJJZD86IHN0cmluZyk6IE9ic2VydmFibGU8VD47XG4gICAgZ2V0UGF0Y2hVcGRhdGVVc2VyRW5kcG9pbnQ8VD4odmFsdWVPclBhdGNoOiBhbnksIG9wT3JVc2VySWQ/OiBzdHJpbmcsIHBhdGg/OiBzdHJpbmcsIGZyb20/OiBhbnksIHVzZXJJZD86IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xuICAgICAgICBsZXQgZW5kcG9pbnRVcmw6IHN0cmluZztcbiAgICAgICAgbGV0IHBhdGNoRG9jdW1lbnQ6IHt9O1xuXG4gICAgICAgIGlmIChwYXRoKSB7XG4gICAgICAgICAgICBlbmRwb2ludFVybCA9IHVzZXJJZCA/IGAke3RoaXMudXNlcnNVcmx9LyR7dXNlcklkfWAgOiB0aGlzLmN1cnJlbnRVc2VyVXJsO1xuICAgICAgICAgICAgcGF0Y2hEb2N1bWVudCA9IGZyb20gP1xuICAgICAgICAgICAgICAgIFt7IHZhbHVlOiB2YWx1ZU9yUGF0Y2gsIHBhdGgsIG9wOiBvcE9yVXNlcklkLCBmcm9tIH1dIDpcbiAgICAgICAgICAgICAgICBbeyB2YWx1ZTogdmFsdWVPclBhdGNoLCBwYXRoLCBvcDogb3BPclVzZXJJZCB9XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGVuZHBvaW50VXJsID0gb3BPclVzZXJJZCA/IGAke3RoaXMudXNlcnNVcmx9LyR7b3BPclVzZXJJZH1gIDogdGhpcy5jdXJyZW50VXNlclVybDtcbiAgICAgICAgICAgIHBhdGNoRG9jdW1lbnQgPSB2YWx1ZU9yUGF0Y2g7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBhdGNoPFQ+KGVuZHBvaW50VXJsLCBKU09OLnN0cmluZ2lmeShwYXRjaERvY3VtZW50KSwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFBhdGNoVXBkYXRlVXNlckVuZHBvaW50KHZhbHVlT3JQYXRjaCwgb3BPclVzZXJJZCwgcGF0aCwgZnJvbSwgdXNlcklkKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG5cbiAgICBnZXRVc2VyUHJlZmVyZW5jZXNFbmRwb2ludDxUPigpOiBPYnNlcnZhYmxlPFQ+IHtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxUPih0aGlzLmN1cnJlbnRVc2VyUHJlZmVyZW5jZXNVcmwsIHRoaXMucmVxdWVzdEhlYWRlcnMpLnBpcGU8VD4oXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgKCkgPT4gdGhpcy5nZXRVc2VyUHJlZmVyZW5jZXNFbmRwb2ludCgpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBnZXRVcGRhdGVVc2VyUHJlZmVyZW5jZXNFbmRwb2ludDxUPihjb25maWd1cmF0aW9uOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQ8VD4odGhpcy5jdXJyZW50VXNlclByZWZlcmVuY2VzVXJsLCBKU09OLnN0cmluZ2lmeShjb25maWd1cmF0aW9uKSwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFVwZGF0ZVVzZXJQcmVmZXJlbmNlc0VuZHBvaW50KGNvbmZpZ3VyYXRpb24pKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBnZXRVbmJsb2NrVXNlckVuZHBvaW50PFQ+KHVzZXJJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50VXJsID0gYCR7dGhpcy51bmJsb2NrVXNlclVybH0vJHt1c2VySWR9YDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxUPihlbmRwb2ludFVybCwgbnVsbCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFVuYmxvY2tVc2VyRW5kcG9pbnQodXNlcklkKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgZ2V0RGVsZXRlVXNlckVuZHBvaW50PFQ+KHVzZXJJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50VXJsID0gYCR7dGhpcy51c2Vyc1VybH0vJHt1c2VySWR9YDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZTxUPihlbmRwb2ludFVybCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldERlbGV0ZVVzZXJFbmRwb2ludCh1c2VySWQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cblxuXG5cblxuICAgIGdldFJvbGVFbmRwb2ludDxUPihyb2xlSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8VD4ge1xuICAgICAgICBjb25zdCBlbmRwb2ludFVybCA9IGAke3RoaXMucm9sZXNVcmx9LyR7cm9sZUlkfWA7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8VD4oZW5kcG9pbnRVcmwsIHRoaXMucmVxdWVzdEhlYWRlcnMpLnBpcGU8VD4oXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgKCkgPT4gdGhpcy5nZXRSb2xlRW5kcG9pbnQocm9sZUlkKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG5cbiAgICBnZXRSb2xlQnlSb2xlTmFtZUVuZHBvaW50PFQ+KHJvbGVOYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICAgICAgY29uc3QgZW5kcG9pbnRVcmwgPSBgJHt0aGlzLnJvbGVCeVJvbGVOYW1lVXJsfS8ke3JvbGVOYW1lfWA7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8VD4oZW5kcG9pbnRVcmwsIHRoaXMucmVxdWVzdEhlYWRlcnMpLnBpcGU8VD4oXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgKCkgPT4gdGhpcy5nZXRSb2xlQnlSb2xlTmFtZUVuZHBvaW50KHJvbGVOYW1lKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG5cblxuICAgIGdldFJvbGVzRW5kcG9pbnQ8VD4ocGFnZT86IG51bWJlciwgcGFnZVNpemU/OiBudW1iZXIpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICAgICAgY29uc3QgZW5kcG9pbnRVcmwgPSBwYWdlICYmIHBhZ2VTaXplID8gYCR7dGhpcy5yb2xlc1VybH0vJHtwYWdlfS8ke3BhZ2VTaXplfWAgOiB0aGlzLnJvbGVzVXJsO1xuXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFQ+KGVuZHBvaW50VXJsLCB0aGlzLnJlcXVlc3RIZWFkZXJzKS5waXBlPFQ+KFxuICAgICAgICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlRXJyb3IoZXJyb3IsICgpID0+IHRoaXMuZ2V0Um9sZXNFbmRwb2ludChwYWdlLCBwYWdlU2l6ZSkpO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGdldE5ld1JvbGVFbmRwb2ludDxUPihyb2xlT2JqZWN0OiBhbnkpOiBPYnNlcnZhYmxlPFQ+IHtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8VD4odGhpcy5yb2xlc1VybCwgSlNPTi5zdHJpbmdpZnkocm9sZU9iamVjdCksIHRoaXMucmVxdWVzdEhlYWRlcnMpLnBpcGU8VD4oXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgKCkgPT4gdGhpcy5nZXROZXdSb2xlRW5kcG9pbnQocm9sZU9iamVjdCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgIH1cblxuICAgIGdldFVwZGF0ZVJvbGVFbmRwb2ludDxUPihyb2xlT2JqZWN0OiBhbnksIHJvbGVJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50VXJsID0gYCR7dGhpcy5yb2xlc1VybH0vJHtyb2xlSWR9YDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxUPihlbmRwb2ludFVybCwgSlNPTi5zdHJpbmdpZnkocm9sZU9iamVjdCksIHRoaXMucmVxdWVzdEhlYWRlcnMpLnBpcGU8VD4oXG4gICAgICAgICAgICBjYXRjaEVycm9yKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVFcnJvcihlcnJvciwgKCkgPT4gdGhpcy5nZXRVcGRhdGVSb2xlRW5kcG9pbnQocm9sZU9iamVjdCwgcm9sZUlkKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgZ2V0RGVsZXRlUm9sZUVuZHBvaW50PFQ+KHJvbGVJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgICAgIGNvbnN0IGVuZHBvaW50VXJsID0gYCR7dGhpcy5yb2xlc1VybH0vJHtyb2xlSWR9YDtcblxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZTxUPihlbmRwb2ludFVybCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldERlbGV0ZVJvbGVFbmRwb2ludChyb2xlSWQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICB9XG5cblxuICAgIGdldFBlcm1pc3Npb25zRW5kcG9pbnQ8VD4oKTogT2JzZXJ2YWJsZTxUPiB7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8VD4odGhpcy5wZXJtaXNzaW9uc1VybCwgdGhpcy5yZXF1ZXN0SGVhZGVycykucGlwZTxUPihcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZUVycm9yKGVycm9yLCAoKSA9PiB0aGlzLmdldFBlcm1pc3Npb25zRW5kcG9pbnQoKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgfVxufVxuIl19